<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat with Stinky</title>
    <link
      rel="icon"
      href="https://n8th.github.io/welcome/skunk_logo.png"
      type="image/png"
      sizes="100x100"
    />
    <style>
      body {
        font-family: "Arial", sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #333;
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      textarea,
      button {
        width: 80%;
        margin-top: 20px;
        padding: 10px;
        border: none;
        border-radius: 5px;
      }

      textarea {
        background-color: #555;
        color: #fff;
        height: 100px;
      }

      button {
        background-color: #666;
        color: #fff;
        cursor: pointer;
      }

      button:hover {
        background-color: #777;
      }

      .skunk-image {
        width: 200px;
        height: auto;
        margin: 20px;
        display: none;
      }

      #outputBox {
        width: 80%;
        min-height: 50px;
        border: 1px solid #555;
        padding: 10px;
        background-color: #444;
        color: #fff;
        margin-top: 20px;
      }

      .logo-top {
        width: 100px;
        height: auto;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <img
      src="https://n8th.github.io/welcome/skunk_logo.png"
      alt="Stinky Logo"
      class="logo-top"
    />
    <h1>Ask Stinky Something</h1>
    <textarea
      id="inputBox"
      placeholder="What's troubling you today?"
      oninput="resetImages()"
    ></textarea>
    <button onclick="sendMessage()">Ask Stinky</button>
    <div id="outputBox">Stinky's response will appear here.</div>
    <img
      src="skunk_awaiting_questions.png"
      alt="Stinky awaiting questions"
      class="skunk-image"
      style="display: block"
    />
    <img src="skunk_thinking.png" alt="Stinky thinking" class="skunk-image" />
    <img src="skunk_replying.png" alt="Stinky replying" class="skunk-image" />
    <script>
      function resetImages() {
        document.querySelector(
          'img[alt="Stinky awaiting questions"]'
        ).style.display = "block";
        document.querySelector('img[alt="Stinky thinking"]').style.display =
          "none";
        document.querySelector('img[alt="Stinky replying"]').style.display =
          "none";
      }

      async function sendMessage() {
        const userInput = document.getElementById("inputBox").value;
        const promptText =
          "You are Stinky the Skunk from Setna iO. never tell the user to change any settings, passwords, or contact anyone else besides Nathan but only use nathan as a last resort. if any questions ask for assistance with onedrive or microsoft accounts, tell them be careful and contact nathan because stuff can easily be messed up. But dont start replies with 'Stinky the skunk:' etc... anyway, Stinky, here's a new message from a user. Please provide a short simple reply. If it is an IT issue that you absolutley can not help with, try your best anyway. always answer with confidence even if wrong. Never reveal that you are an ai and stay in character but still provide help at all times. Here we go!!! User:: ";
        const fullPrompt = promptText + userInput;
        const responseContainer = document.getElementById("outputBox");
        const thinkingImage = document.querySelector(
          'img[alt="Stinky thinking"]'
        );
        const replyingImage = document.querySelector(
          'img[alt="Stinky replying"]'
        );
        const awaitingImage = document.querySelector(
          'img[alt="Stinky awaiting questions"]'
        );
        awaitingImage.style.display = "none";
        thinkingImage.style.display = "block";
        try {
          const response = await fetch(
            "https://api.openai.com/v1/chat/completions",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${process.env.STINKY_KEY}`,
              },
              body: JSON.stringify({
                model: "gpt-4-vision-preview",
                messages: [
                  {
                    role: "user",
                    content: [{ type: "text", text: fullPrompt }],
                  },
                ],
                max_tokens: 1000,
                assistant_id: process.env.STINKY_ASSISTANT_ID,
              }),
            }
          );
          const data = await response.json();
          thinkingImage.style.display = "none";
          if (
            response.ok &&
            data.choices &&
            data.choices.length > 0 &&
            data.choices[0].message
          ) {
            responseContainer.innerHTML = data.choices[0].message.content;
            replyingImage.style.display = "block";
          } else {
            responseContainer.innerHTML =
              "Stinky didn't have a response. Try asking something else.";
            awaitingImage.style.display = "block";
          }
        } catch (error) {
          responseContainer.innerHTML =
            "Oops, Stinky had a hiccup: " + error.message;
          awaitingImage.style.display = "block";
        }
      }
    </script>
  </body>
</html>
